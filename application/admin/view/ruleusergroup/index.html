{extend name="base" /}
{block name="head"}
{/block}
{block name="main"}
<div id="fuyun-app" class="fuyun-app">
<!--   <div class="search-box">
    <div class="fuyun-title">
      <h5>筛选条件</h5>
    </div>
    <div class="search-content">
      <form action="" method="">
        <div class="fuyun-form-item layui-inline">
          <label>品牌名称</label>
          <input class="layui-input" type="text" name="brand_name" value="" placeholder="输入品牌名称">
        </div>
        <div class="fuyun-form-item layui-inline" style="padding-top:18px;">
          <button class="layui-btn layui-btn-normal">搜索</button>
        </div>
      </form>
    </div>
  </div>
 -->
  <div class="content-box">
    <div class="fuyun-title">
      <h5>角色列表</h5>
      <a href="javascript:;" class="layui-btn fuyun-add-btn layui-btn-small layui-btn-normal add"><i class="fa fa-plus-square margin-right-5"></i>添加角色</a>
    </div>
    <div class="main-box">
      <div class="layui-form">
        <table class="layui-table layui-form">
          <thead>
            <tr>
              <th width="10%">角色</th>
              <th>子角色</th>
              <th>权限组</th>
              <th>验证规则</th>
              <th width="10%">操作</th>
            </tr> 
          </thead>
          <tbody>
            {volist name="list['data']" id="vo"}
              <tr data-id="{$vo.id}">
                <td>{$vo.user_group_name}</td>
                <td>
                  <?php foreach(json_decode($vo['user_group_ids']) as $user_group_ids):?>
                    <span><?=$list['user_group'][$user_group_ids]?></span>
                  <?php endforeach ?>
                </td>
                <td>
                  <?php foreach(json_decode($vo['group_ids']) as $group_ids):?>
                    <span><?=$list['group'][$group_ids]?></span>
                  <?php endforeach ?>
                </td>
                <td>
                  <?php foreach(json_decode($vo['rule_ids']) as $rule_ids):?>
                    <span><?=$list['rule'][$rule_ids]?></span>
                  <?php endforeach ?>
                </td>
                <td>
                  <div class="layui-btn-group">
                    <a class="layui-btn layui-btn-normal layui-btn-small edit" data-id="{$vo.id}" href="javascript:;">编辑</a>
                    <button class="layui-btn fuyun-btn-del layui-btn-small btn-del-id" data-url="{:Url('deleteAll')}" data-confirm="确定删除该分类吗？" data-successtip="删除成功！" data-id="<?=$vo['id']?>" ><i class="fa fa-close margin-right-5"></i>删除</button>
                  </div>
                </td>
              </tr>
            {/volist}
          </tbody>
        </table>
      </div>
      <div class="page-box">
        <fuyun-page 
          :pagesize="<?=$list['pageSize']?>" 
          :total = "<?=$list['totalRow']?>"
          :current-page = {$list['curPage']}
        ></fuyun-page>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  layui.use([ 'layer','form'], function(){
    var layer = layui.layer;
    var form = layui.form();
    //全选
    form.on('checkbox(allChoose)', function(data){
      var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
      child.each(function(index, item){
          item.checked = data.elem.checked;
      });
      form.render('checkbox');
    });

    $(".add").click(function(){
      layer.open({
        type: 2,
        area:['580px','600px'],
        content: "{:Url('add')}"
      });
    });

    $(".edit").click(function(){
      var id = $(this).attr("data-id");
      layer.open({
          type: 2,
          area:['580px','600px'],
          content: "{:Url('edit')}?id="+id
      });
    });
  });

  fuyun.components(['page'],{
    el:"#fuyun-app",
    data:{
      labelPosition: 'top',
    },
  });
</script>
{/block}

